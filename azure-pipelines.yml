trigger:
  branches:
    include:
    - branch-for-*
pr: none

variables:
  # Name of the service connection set up in Azure Pipelines, used to upload
  # release artifacts to GitHub. Set to false to disable.
  GH_CONNECTION: wheelwright
  REPO_DIR: checkout
  ARTIFACT_NAME: artifacts
  LINUX_TARGET: /io
  BUILD_DEPENDS: "-Ur checkout/requirements.txt setuptools"
  TEST_DEPENDS: "-Ur checkout/requirements.txt setuptools"
  PLAT: x86_64
  UNICODE_WIDTH: 32
  HOMEBREW_NO_AUTO_UPDATE: 1
  MANYLINUX_VERSION: 2014

jobs:
- job: 'wheels'
  condition: not(eq(dependencies.sdist.outputs['set_variables.universal'], 'True'))
  continueOnError: true
  timeoutInMinutes: 240
  strategy:
    matrix:
      Python311Windows:
        imageName: 'windows-2019'
        python.version: '3.11'
        os: win
      Python311Linux:
        imageName: 'ubuntu-20.04'
        python.version: '3.11'
        os: linux
      Python311Mac:
        imageName: 'macos-11'
        python.version: '3.11'
        os: osx
    maxParallel: 4
  pool:
    vmImage: $(imageName)
  variables:
    py35: $[ dependencies.sdist.outputs['set_variables.py35'] ]

  steps:
  - template: azure-wheels-steps.yml
    parameters:
      python_version: '$(python.version)'
